<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test GitHub Activity Calendar</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .success {
        color: green;
      }
      .error {
        color: red;
      }
      .info {
        color: blue;
      }
      .section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ccc;
        border-radius: 5px;
      }
      button {
        padding: 10px 15px;
        margin: 5px;
        cursor: pointer;
      }
      pre {
        background: #f5f5f5;
        padding: 10px;
        border-radius: 3px;
        overflow-x: auto;
      }
      .calendar-grid {
        display: grid;
        grid-template-columns: repeat(53, 12px);
        gap: 2px;
        margin: 10px 0;
      }
      .day-square {
        width: 12px;
        height: 12px;
        border-radius: 2px;
      }
    </style>
  </head>
  <body>
    <h1>üß™ Test GitHub Activity Calendar</h1>
    <p>This tests the GitHub GraphQL API for fetching contribution data.</p>

    <div class="section">
      <h2>Test GitHub GraphQL API</h2>
      <input
        type="text"
        id="username"
        placeholder="GitHub username (e.g., Srie06)"
        value="Srie06"
        style="padding: 8px; margin-right: 10px"
      />
      <button onclick="testGitHubAPI()">Test GitHub API</button>
      <div id="apiResult"></div>
    </div>

    <div class="section">
      <h2>Contribution Calendar Preview</h2>
      <div id="calendarPreview"></div>
    </div>

    <script>
      // GitHub GraphQL query
      const CONTRIBUTION_CALENDAR_QUERY = `
          query($username: String!, $from: DateTime!, $to: DateTime!) {
            user(login: $username) {
              contributionsCollection(from: $from, to: $to) {
                contributionCalendar {
                  totalContributions
                  weeks {
                    contributionDays {
                      contributionCount
                      date
                      color
                      contributionLevel
                    }
                  }
                }
              }
            }
          }
        `;

      // Test GitHub GraphQL API
      async function testGitHubAPI() {
        const username = document.getElementById("username").value.trim();

        if (!username) {
          document.getElementById("apiResult").innerHTML = `
                    <div class="error">‚ùå Please enter a GitHub username</div>
                `;
          return;
        }

        console.log("üß™ Testing GitHub GraphQL API for:", username);

        // Calculate date range (last 365 days)
        const to = new Date();
        const from = new Date();
        from.setFullYear(from.getFullYear() - 1);

        try {
          const response = await fetch("https://api.github.com/graphql", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              // Note: Without auth token, we'll get rate limited but can still test the structure
            },
            body: JSON.stringify({
              query: CONTRIBUTION_CALENDAR_QUERY,
              variables: {
                username,
                from: from.toISOString(),
                to: to.toISOString(),
              },
            }),
          });

          console.log("üì° GitHub API Response status:", response.status);
          const data = await response.json();
          console.log("üìä GitHub API Response data:", data);

          if (data.data?.user?.contributionsCollection?.contributionCalendar) {
            const calendar =
              data.data.user.contributionsCollection.contributionCalendar;

            document.getElementById("apiResult").innerHTML = `
                        <div class="success">
                            ‚úÖ GitHub API Success!<br><br>
                            <strong>Contribution Data:</strong><br>
                            ‚Ä¢ Total Contributions: ${
                              calendar.totalContributions
                            }<br>
                            ‚Ä¢ Weeks of Data: ${calendar.weeks.length}<br>
                            ‚Ä¢ Days of Data: ${calendar.weeks.reduce(
                              (total, week) =>
                                total + week.contributionDays.length,
                              0
                            )}<br><br>
                            
                            <div class="info">
                                üéØ This data will be used to render the green dots calendar!
                            </div>
                        </div>
                    `;

            // Render a simple calendar preview
            renderCalendarPreview(calendar);
          } else if (data.errors) {
            document.getElementById("apiResult").innerHTML = `
                        <div class="error">
                            ‚ùå GitHub API Error:<br>
                            ${data.errors
                              .map((err) => err.message)
                              .join("<br>")}
                            <br><br>
                            <div class="info">
                                üí° This is expected without authentication token.<br>
                                The React component will work with proper GitHub OAuth token.
                            </div>
                        </div>
                    `;
          } else {
            document.getElementById("apiResult").innerHTML = `
                        <div class="error">
                            ‚ùå Unexpected response format<br>
                            ${JSON.stringify(data, null, 2)}
                        </div>
                    `;
          }
        } catch (error) {
          console.error("‚ùå GitHub API test failed:", error);
          document.getElementById("apiResult").innerHTML = `
                    <div class="error">
                        ‚ùå Network Error: ${error.message}<br>
                        Make sure you have internet connection.
                    </div>
                `;
        }
      }

      // Render a simple calendar preview
      function renderCalendarPreview(calendar) {
        const previewDiv = document.getElementById("calendarPreview");

        if (!calendar || !calendar.weeks) {
          previewDiv.innerHTML =
            '<div class="error">No calendar data to preview</div>';
          return;
        }

        let html = `
                <h3>Contribution Calendar Preview (Last ${calendar.weeks.length} weeks)</h3>
                <p>Total: ${calendar.totalContributions} contributions</p>
                <div class="calendar-grid">
            `;

        // Render each week
        calendar.weeks.forEach((week) => {
          week.contributionDays.forEach((day) => {
            const color = getContributionColor(day.contributionLevel);
            html += `
                        <div 
                            class="day-square" 
                            style="background-color: ${color};"
                            title="${day.contributionCount} contributions on ${day.date}"
                        ></div>
                    `;
          });
        });

        html += "</div>";

        // Add legend
        html += `
                <div style="margin-top: 10px; display: flex; align-items: center; gap: 5px; font-size: 12px;">
                    <span>Less</span>
                    <div class="day-square" style="background-color: #ebedf0;"></div>
                    <div class="day-square" style="background-color: #9be9a8;"></div>
                    <div class="day-square" style="background-color: #40c463;"></div>
                    <div class="day-square" style="background-color: #30a14e;"></div>
                    <div class="day-square" style="background-color: #216e39;"></div>
                    <span>More</span>
                </div>
            `;

        previewDiv.innerHTML = html;
      }

      // Get contribution level color (GitHub's color scheme)
      function getContributionColor(level) {
        switch (level) {
          case "NONE":
            return "#ebedf0";
          case "FIRST_QUARTILE":
            return "#9be9a8";
          case "SECOND_QUARTILE":
            return "#40c463";
          case "THIRD_QUARTILE":
            return "#30a14e";
          case "FOURTH_QUARTILE":
            return "#216e39";
          default:
            return "#ebedf0";
        }
      }

      // Auto-test on load
      console.log(`
üß™ GITHUB ACTIVITY CALENDAR TEST

This tests the GitHub GraphQL API that powers the activity calendar.

Expected Results:
- Without auth token: Will get rate limited but shows API structure
- With auth token: Will return full contribution data

The React component will use the user's GitHub OAuth token for full access.
        `);
    </script>
  </body>
</html>
